# webpack

模块化打包工具

## 环境

推荐最新稳定版node，打包速度更快

### 全局安装(不推荐)

```BASH
# 安装webpack V4+版本时,需要额外安装webpack-cli
npm install webpack webpack-cli -g
# 检查版本
webpack -v
# 卸载
npm uninstall webpack webpack-cli -g
```

会锁定所有项目至指定版本

### 局部安装

```BASH
# 安装最新的稳定版本
npm i -D webpack
# 安装指定版本
npm i -D webpack@<version>
# 安装最新的体验版本 可能包含bug,不要用于生产环境
npm i -D webpack@beta
# 安装webpack V4+版本时,需要额外安装webpack-cli
npm i -D webpack-cli
```

^表示大版本不动，小版本自动更新

-D 开发依赖(--dev) 
-S 生产依赖(--save)（线上环境会使用到的, 默认）

### 检查安装

```BASH
# 默认全局寻找
webpack -v 
# npx是在当前项目查找
npx webpack -v 
# 指定模块查找
./node_modules/.bin/webpack -v
```

npx npm自带工具，软连接到./node_modules/webpack/bin/webpack.js

### 执行构建

```BASH
# npx方方式 (会提示指定模式，默认为production)
npx webpack
# npm script
npm run test
```

修改package.json

```json
"scripts": {
    "test": "webpack"
},
```

### 配置

#### 默认配置

1. 默认支持js,json
2. 默认支持CommonJS, ES moudle, AMD模块

当没有指定webpack.config.js时，webpack会指定以下配置作为默认配置

```js
const path = require("path");
module.exports = {
    // 必填, 打包构建入口，可以为数组用于多入口
    entry: "./src/index.js",
    // 出口
    output: {
        filename: "main.js",
        // 构建文件资源地址，必须为绝对路径
        // __dirname node.js的全局变量，当前文件的绝对路径
        path: path.resolve(__dirname, "./dist")
    }
};
```

### 其他配置

```js
const path = require("path");
module.exports = {
    // 上下文 项目打包的相对路径 默认值 process.cwd()， 必须为绝对路径
    context: "",
    // 必填, 打包构建入口
    // entry: "./src/index.js", // 字符串
    // entry: ["./src/index.js"], // 数组，将多个js打包成一个js文件，其实是进行拼接，将两个文件的代码拼接到一个文件中

    entry: { // 对象，只有对象可以多入口 多入口对应多出口，value可以是数组
        index: "./src/index.js",
        other: "./src/other.js",
    }

    // 出口
    output: {
        // 字符串和数组
        // filename: "main.js",
        // 对象, 用name作为占位符，从entry获取key
        // 论多出口还是单出口，都推荐占位符
        filename: "[name].js",
        // filename: "[name]-[hash:20].js", // 默认长度20
        // filename: "[name]-[hash:6].js", // 指定长度为6 

        // 占位符
        // hash  整个项目的hash值，每构建一次都会生成一个新的，不利于缓存
        // chunkhash   根据不同入口的entry进行依赖解析，构建对应的chunk，只要组成的entry未改变，则对应的的hash不变，利于缓存
        // contenthash 多用于样式优化
        // name
        // id

        // 构建文件资源地址，必须为绝对路径
        // __dirname node.js的全局变量，当前文件的绝对路径
        path: path.resolve(__dirname, "./dist")

        mode: "development", // 设定是生产模式还是开发模式
    }
};
```

一个chunk对应一个bundle

chunk是代码块，控制资源的渲染

bundle是资源文件

一个chunk可以多个模块组成，node.js中万物皆模块（文件）

数组的化， webpack会自动生成另外一个入口模块，并将数组中的每个指定模块加载进来，并将最后一个模块的module.exports作为入口模块的module.exports导出

数组多对一整合，对象多对多映射

#### loader

函数

默认只处理js和json，当需要其他格式文件处理时，可以添加新模块如 css-loader等等

#### moudle

遇见处理到不认识的模块时，需要在module中进行配置处理

```js
{
    module: {
        rules: [{
            test: /\.xxx$/, //指定匹配规则
            // use: {
            //     loader: 'xxx-load' //指定使⽤的loader
            // }
            use: ["style-loader", "css-loader"],
        }]
    }
}
```

css-loader 将css模块类容加入到js模块内容中去
style-loader 从js中提取css的loader， 在html中创建style标签，并将css-loader解析的文件放入标签中

#### Plugins

类

1. 作⽤于webpack打包整个过程
2. webpack的打包过程是有（⽣命周期概念）钩⼦

 webpack的打包过程中执行一些事情

#### hash chunkhash contenthash

hash  整个项目的hash值，每构建一次都会生成一个新的，不利于缓存

chunkhash   根据不同入口的entry进行依赖解析，构建对应的chunk，只要组成的entry未改变，则对应的的hash不变，利于缓存

contenthash

使用chunkhash时，引入css的js文件变化时，会导致css的名称也会变化，导致之前缓存失效

contenthash则不会出现这个问题

```js
    new MiniCssExtractPlugin({
        filename: "css/[name]-[contenthash:8].css"
    })
```
